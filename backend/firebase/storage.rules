rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      // Allow authenticated users to read and write to their own folder
      match /users/{userId}/{allUserPaths=**} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
      
      // Allow read access to public assets (product images, etc.)
      match /public/{allPublicPaths=**} {
        allow read: if true;
        allow write: if request.auth != null; // Restrict writes to admins if role-based is implemented
      }

      // POS specific: store receipts or product images under shop/user context
      match /shops/{shopId}/{allShopPaths=**} {
         allow read: if request.auth != null;
         allow write: if request.auth != null; // Add shop-based ownership logic here if needed
      }
    }
  }
}
